<h1>Customers</h1>

<div>
    <a href="/">Home</a> | <a href="/customers">Customers</a> | <a href="/memberships">Memberships</a> | <a
        href="/locations">Locations</a> | <a href="fitness_classes">Fitness_Classes</a> | <a
        href="/personal_trainers">Personal_Trainers</a> | <a href="/trainer_customer">Trainer_Customer</a> | <a
        href="/class_schedule">Class_Schedule</a> | <a href="/membership_location">Membership_Location</a>
</div>

<!--Read Customers-->
<div style="display:block">
    <p><strong>Browse Customers</strong></p>
    <table border="1" cellpadding="5" id="customers-table">
        <thead>
            <!-- For just the first row, we print each key of the row object as a header cell so we
            know what each column means when the page renders -->
            <thead>
                <tr>
                    {{#each data.[0]}}
                    <th>
                        {{@key}}
                    </th>
                    {{/each}}
                    <th>Delete</th>
                </tr>
            </thead>
        </thead>

        <tbody>
            <!-- For each row, print the id, fname, lname, homeworld and age, in order -->
            {{#each data}}
            <tr data-value={{this.ID}}>
                <td>{{this.ID}}</td>
                <td>{{this.First_Name}}</td>
                <td>{{this.Last_Name}}</td>
                <td>{{this.Active}}</td>
                <td>{{this.Email}}</td>
                <td>{{this.Membership_ID}}</td>
                <td><button onclick="deletePerson({{this.ID}})">Delete</button></td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>
<br>

<!--Search Customers-->
<div id="search" style="display: block">
    <form id="searchCustomer">
        <legend><strong>Search Customer</strong></legend>
        <fieldset class="fields">
            <label> Last Name </label> <input type="text" name="l_name"> <br>
        </fieldset>
        <input class=" btn" type="submit" id="searchCustomer" value="Search a Customer">
        <input class="btn" type="button" value="cancel">
    </form>
</div>
<br>

<!--Create Customers-->
<div id="insert" style="display: block">
    <form id="addCustomer" method="POST" action="/add-customer-form">
        <legend><strong>Add a Customer</strong></legend>
        <fieldset class="fields">
            <label> First Name </label> <input type="text" name="input-fname" id="input-fname"> <span>*Required</span>
            <br>
            <label> Last Name </label> <input type="text" name="input-lname" id="input-lname"> <span>*Required</span>
            <br>
            <label> Email </label> <input type="text" name="input-email" id="input-email"> <br>
            <label> Membership </label>
            <select name="input-membership-id" id="input-membership-id">
                <option value="">Select a Membership</option>
                {{#each memberships}}
                <option value="{{this.membership_id}}">{{this.membership_name}}</option>
                {{/each}}
            </select> <span>*Required</span>
        </fieldset>
        <input class=" btn" type="submit" id="addCustomer" value="Add a Customer">
        <input class="btn" type="button" value="cancel">
    </form>
</div>
<br>

<!--Update Customer-->
<div id="update" style="display: block">
    <form id="updateCustomer">
        <legend><strong>Update Customer</strong></legend>
        <fieldset class="fields">
            <label>ID:</label> 1
            <label> First Name </label> <input type="text" value="John" name="fname"> <span>*Required</span> <br>
            <label> Last Name </label> <input type="text" value="Smith" name="lname"> <span>*Required</span> <br>
            <label> Is Active</label>
            <select name="isActive">
                <option value="1">Active</option>
                <option value="0">Not Active</option>
            </select> <span>*Required</span> <br>
            <label> Email </label> <input type="email" name="email" value="johnsmith@gmail.com"> <br>
            <label> Membership </label> <input type="text" name="membership" value="General - 60">
            <span>*Required</span>
        </fieldset>
        <input class="btn" type="submit" id="UpdateSaveCustomer" value="Save Update Customer">
        <input class="btn" type="button" value="cancel">
    </form>
</div>

<script>
    function deletePerson(personID) {
        console.log(personID);
        // Put our data we want to send in a javascript object
        let data = {
            id: personID
        };

        // Setup our AJAX request
        var xhttp = new XMLHttpRequest();
        xhttp.open("DELETE", "/delete-person-ajax", true);
        xhttp.setRequestHeader("Content-type", "application/json");

        // Tell our AJAX request how to resolve
        xhttp.onreadystatechange = () => {
            if (xhttp.readyState == 4 && xhttp.status == 204) {
                console.log("Received 204 status");

                // Add the new data to the table
                deleteRow(personID);

            }
            else if (xhttp.readyState == 4 && xhttp.status != 204) {
                console.log("There was an error with the input.")
            }
        }
        console.log(data);
        console.log(JSON.stringify(data));
        // Send the request and wait for the response
        xhttp.send(JSON.stringify(data));
    }


    function deleteRow(personID) {
        // let pID = personID.toString()
        // console.log("Inside deleteRow");
        // console.log(pID)
        let table = document.getElementById("customers-table");
        for (let i = 0, row; row = table.rows[i]; i++) {
            // getAtt = table.rows[i].cells[0].innerHTML
            // console.log(getAtt)
            if (table.rows[i].cells[0].innerHTML == personID.toString()) {
                // console.log("Found user with personID=" + pID);
                table.deleteRow(i);
                break;
            }
        }
    }
</script>